<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatigue Calculator - Energy Queensland</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'eq-blue': '#1976D2',
                    'eq-blue-dark': '#1565C0',
                    'fatigue-low': '#4CAF50',
                    'fatigue-moderate': '#FF9800', 
                    'fatigue-high': '#F44336',
                    'fatigue-extreme': '#9C27B0'
                },
                fontFamily: {
                    'roboto': ['Roboto', 'sans-serif']
                }
            }
        }
    };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 font-roboto min-h-screen">
    <!-- Header -->
    <header class="bg-eq-blue text-white shadow-lg">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center space-x-3">
                <i class="fas fa-calculator text-2xl"></i>
                <div>
                    <h1 class="text-2xl font-bold">Fatigue Calculator</h1>
                    <p class="text-blue-100 text-sm">Energy Queensland Safety Tool</p>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-6 space-y-6">
        <!-- Introduction Card -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
            <div class="flex items-start space-x-3">
                <i class="fas fa-info-circle text-eq-blue text-xl mt-1"></i>
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 mb-2">About This Calculator</h2>
                    <p class="text-gray-700">The fatigue calculator is designed to help keep you safe. Find out your likelihood of being fatigued in three easy steps.</p>
                </div>
            </div>
        </div>

        <!-- Calculator Form -->
        <div class="bg-white rounded-lg shadow-sm border">
            <div class="bg-gray-50 px-6 py-4 border-b">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-bed text-eq-blue mr-2"></i>
                    Sleep History
                </h3>
            </div>
            
            <form class="p-6 space-y-6" id="fatigueForm">
                <!-- @COMPONENT: SleepHistoryForm -->
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Sleep in last 24 hours -->
                    <div>
                        <label for="sleep24" class="block text-sm font-medium text-gray-700 mb-2">
                            Sleep in the 24 hours before starting work
                        </label>
                        <select id="sleep24" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-eq-blue focus:border-eq-blue bg-white" data-bind="sleepLast24">
                            <option value="">Select hours...</option>
                            <option value="0">0 hours</option>
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="4">4 hours</option>
                            <option value="5">5 hours</option>
                            <option value="6">6 hours</option>
                            <option value="7">7 hours</option>
                            <option value="8">8 hours</option>
                            <option value="9">9 hours</option>
                            <option value="10">10 hours</option>
                            <option value="11">11 hours</option>
                            <option value="12">12 hours</option>
                        </select>
                    </div>

                    <!-- Sleep in previous 24 hours -->
                    <div>
                        <label for="sleepPrevious24" class="block text-sm font-medium text-gray-700 mb-2">
                            Sleep in the previous 24 hours (before that)
                        </label>
                        <select id="sleepPrevious24" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-eq-blue focus:border-eq-blue bg-white" data-bind="sleepPrevious24">
                            <option value="">Select hours...</option>
                            <option value="0">0 hours</option>
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="4">4 hours</option>
                            <option value="5">5 hours</option>
                            <option value="6">6 hours</option>
                            <option value="7">7 hours</option>
                            <option value="8">8 hours</option>
                            <option value="9">9 hours</option>
                            <option value="10">10 hours</option>
                            <option value="11">11 hours</option>
                            <option value="12">12 hours</option>
                        </select>
                    </div>
                </div>

                <!-- Total sleep display -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Total sleep in the last 48 hours:</span>
                        <span id="totalSleep48" class="text-lg font-bold text-eq-blue" data-bind="totalSleep48">0 hours</span>
                    </div>
                </div>

                <!-- Wake up time -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label for="wakeTime" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-sun text-orange-500 mr-1"></i>
                            What time did you wake up today?
                        </label>
                        <select id="wakeTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-eq-blue focus:border-eq-blue bg-white" data-bind="wakeTime">
                            <option value="">Select time...</option>
                            <!-- Generate time options -->
                        </select>
                    </div>

                    <!-- Work start time -->
                    <div>
                        <label for="workStartTime" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-briefcase text-eq-blue mr-1"></i>
                            What time do you start work?
                        </label>
                        <select id="workStartTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-eq-blue focus:border-eq-blue bg-white" data-bind="workStartTime">
                            <option value="">Select time...</option>
                            <!-- Generate time options -->
                        </select>
                    </div>
                </div>

                <!-- Calculate Button -->
                <div class="flex justify-center pt-4">
                    <button type="button" id="calculateBtn" class="bg-eq-blue hover:bg-eq-blue-dark text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200 flex items-center space-x-2" data-event="click:calculateFatigue">
                        <i class="fas fa-calculator"></i>
                        <span>Calculate</span>
                    </button>
                </div>
                <!-- @END_COMPONENT: SleepHistoryForm -->
            </form>
        </div>

        <!-- Results Section -->
        <!-- @COMPONENT: FatigueResults [hidden initially] -->
        <div id="resultsSection" class="bg-white rounded-lg shadow-sm border hidden">
            <div class="bg-gray-50 px-6 py-4 border-b">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-chart-bar text-eq-blue mr-2"></i>
                    Your Current Likelihood of Fatigue
                </h3>
            </div>
            
            <div class="p-6">
                <!-- Fatigue Score Display -->
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-24 h-24 rounded-full mb-4" id="fatigueScoreCircle">
                        <span id="fatigueScore" class="text-2xl font-bold text-white" data-bind="fatigueScore">0</span>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Fatigue Level:</p>
                        <p id="fatigueLevel" class="text-2xl font-bold" data-bind="fatigueLevel">Not Calculated</p>
                    </div>
                </div>

                <!-- Fatigue Level Indicator -->
                <div class="grid grid-cols-4 gap-2 mb-6">
                    <div class="text-center">
                        <div id="lowIndicator" class="h-8 bg-gray-200 rounded-t-lg flex items-center justify-center">
                            <span class="text-xs font-medium text-gray-500">Low</span>
                        </div>
                        <div class="text-xs text-gray-600 mt-1">1-3</div>
                    </div>
                    <div class="text-center">
                        <div id="moderateIndicator" class="h-8 bg-gray-200 rounded-t-lg flex items-center justify-center">
                            <span class="text-xs font-medium text-gray-500">Moderate</span>
                        </div>
                        <div class="text-xs text-gray-600 mt-1">4-6</div>
                    </div>
                    <div class="text-center">
                        <div id="highIndicator" class="h-8 bg-gray-200 rounded-t-lg flex items-center justify-center">
                            <span class="text-xs font-medium text-gray-500">High</span>
                        </div>
                        <div class="text-xs text-gray-600 mt-1">7-8</div>
                    </div>
                    <div class="text-center">
                        <div id="extremeIndicator" class="h-8 bg-gray-200 rounded-t-lg flex items-center justify-center">
                            <span class="text-xs font-medium text-gray-500">Extreme</span>
                        </div>
                        <div class="text-xs text-gray-600 mt-1">9-10</div>
                    </div>
                </div>

                <!-- Recalculate Button -->
                <div class="text-center">
                    <button id="recalculateBtn" class="text-eq-blue hover:text-eq-blue-dark font-medium underline" data-event="click:resetForm">
                        <i class="fas fa-redo mr-1"></i>
                        Re-calculate
                    </button>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: FatigueResults -->

        <!-- Action Guidelines -->
        <div class="bg-white rounded-lg shadow-sm border">
            <div class="bg-gray-50 px-6 py-4 border-b">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                    <i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i>
                    Important Information
                </h3>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fatigue Level</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action Required</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <tr class="hover:bg-green-50">
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-fatigue-low text-white">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    Low
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-700">
                                Good to go? Continue to monitor fatigue. Note the assessment on HazChat.
                            </td>
                        </tr>
                        <tr class="hover:bg-yellow-50">
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-fatigue-moderate text-white">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    Moderate
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-700">
                                Discuss with team/crew, decide on appropriate controls. Consider whether high risk tasks should occur. Advise Supervisor if appropriate. Controls may include self and peer monitoring, task rotation, increased breaks, pacing work load. Note the assessment and actions on HazChat.
                            </td>
                        </tr>
                        <tr class="hover:bg-red-50">
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-fatigue-high text-white">
                                    <i class="fas fa-times-circle mr-1"></i>
                                    High
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-700">
                                <strong>Stop Work.</strong> Discuss controls with crew/team and with Supervisor. High risk tasks should not be performed. Controls may include increased supervision, task re-assignment, buddy check, arrange back-up, transport alternatives may be required. Note the assessment and actions on HazChat.
                            </td>
                        </tr>
                        <tr class="hover:bg-purple-50">
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-fatigue-extreme text-white">
                                    <i class="fas fa-ban mr-1"></i>
                                    Extreme
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-700">
                                <strong>Stop Work (or do not commence).</strong> Discuss contingency with supervisor. Controls are unlikely to be sufficient. Make arrangements to convey worker home. Continuing with any work requires GM approval. Note the assessment and actions on HazChat.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-start space-x-3">
                <i class="fas fa-question-circle text-eq-blue text-xl mt-1"></i>
                <div>
                    <p class="text-sm text-gray-700">
                        Questions about the calculator? 
                        <a href="mailto:occupationalhealth@energyq.com.au" class="text-eq-blue hover:text-eq-blue-dark font-medium underline">Email us</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div class="flex items-start space-x-3">
                <i class="fas fa-info-circle text-yellow-600 text-xl mt-1"></i>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-2">Disclaimer</h4>
                    <p class="text-sm text-gray-700">
                        The information and data contained on this page including but not limited to the fatigue calculator has been developed for Energy Queensland employee purposes only and shouldn't be relied upon for any other purpose/s. No warranty or representation is made as to its accuracy or completeness.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-4xl mx-auto px-4 py-6">
            <div class="flex flex-wrap justify-center space-x-4 text-sm mb-4">
                <a href="#" class="hover:text-gray-300">Right to information</a>
                <span class="text-gray-500">-</span>
                <a href="#" class="hover:text-gray-300">Terms of use</a>
                <span class="text-gray-500">-</span>
                <a href="#" class="hover:text-gray-300">Privacy statement</a>
                <span class="text-gray-500">-</span>
                <a href="#" class="hover:text-gray-300">Suppliers</a>
            </div>
            <p class="text-center text-sm text-gray-400">
                Copyright 2025 Energy Queensland. All rights reserved.
            </p>
        </div>
    </footer>

    <script>
    (function() {
        // Generate time options for select dropdowns
        function generateTimeOptions() {
            const times = [];
            for (let hour = 0; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const timeString = String(hour).padStart(2, '0') + ':' + String(minute).padStart(2, '0');
                    const displayTime = hour === 0 ? `12:${String(minute).padStart(2, '0')} AM` :
                                       hour < 12 ? `${hour}:${String(minute).padStart(2, '0')} AM` :
                                       hour === 12 ? `12:${String(minute).padStart(2, '0')} PM` :
                                       `${hour - 12}:${String(minute).padStart(2, '0')} PM`;
                    times.push({value: timeString, display: displayTime});
                }
            }
            return times;
        }

        // Populate time dropdowns
        const timeOptions = generateTimeOptions();
        const wakeTimeSelect = document.getElementById('wakeTime');
        const workStartTimeSelect = document.getElementById('workStartTime');

        timeOptions.forEach(time => {
            const option1 = new Option(time.display, time.value);
            const option2 = new Option(time.display, time.value);
            wakeTimeSelect.add(option1);
            workStartTimeSelect.add(option2);
        });

        // Update total sleep calculation
        function updateTotalSleep() {
            const sleep24 = parseInt(document.getElementById('sleep24').value) || 0;
            const sleepPrevious24 = parseInt(document.getElementById('sleepPrevious24').value) || 0;
            const total = sleep24 + sleepPrevious24;
            document.getElementById('totalSleep48').textContent = total + ' hours';
        }

        // Calculate fatigue score
        function calculateFatigueScore() {
            const sleep24 = parseInt(document.getElementById('sleep24').value) || 0;
            const sleepPrevious24 = parseInt(document.getElementById('sleepPrevious24').value) || 0;
            const wakeTime = document.getElementById('wakeTime').value;
            const workStartTime = document.getElementById('workStartTime').value;

            // Validate inputs
            if (!sleep24 && sleep24 !== 0) {
                alert('Please select sleep in the last 24 hours');
                return;
            }
            if (!sleepPrevious24 && sleepPrevious24 !== 0) {
                alert('Please select sleep in the previous 24 hours');
                return;
            }
            if (!wakeTime) {
                alert('Please select when you woke up today');
                return;
            }
            if (!workStartTime) {
                alert('Please select your work start time');
                return;
            }

            // Simple fatigue calculation algorithm (simplified version)
            // TODO: Implement actual Energy Queensland algorithm based on documentation
            let fatigueScore = 0;

            // Sleep deficit scoring
            if (sleep24 < 6) fatigueScore += 3;
            else if (sleep24 < 7) fatigueScore += 2;
            else if (sleep24 < 8) fatigueScore += 1;

            const totalSleep48 = sleep24 + sleepPrevious24;
            if (totalSleep48 < 12) fatigueScore += 2;
            else if (totalSleep48 < 14) fatigueScore += 1;

            // Time awake calculation
            const [wakeHour, wakeMinute] = wakeTime.split(':').map(Number);
            const [workHour, workMinute] = workStartTime.split(':').map(Number);
            
            const wakeTimeMinutes = wakeHour * 60 + wakeMinute;
            const workTimeMinutes = workHour * 60 + workMinute;
            
            let timeAwake = workTimeMinutes - wakeTimeMinutes;
            if (timeAwake < 0) timeAwake += 24 * 60; // Next day
            
            const hoursAwake = timeAwake / 60;
            if (hoursAwake > 16) fatigueScore += 3;
            else if (hoursAwake > 14) fatigueScore += 2;
            else if (hoursAwake > 12) fatigueScore += 1;

            // Night shift penalty
            if (workHour >= 23 || workHour <= 5) {
                fatigueScore += 2;
            }

            // Cap at 10
            fatigueScore = Math.min(10, fatigueScore);

            displayResults(fatigueScore);
        }

        function displayResults(score) {
            const resultsSection = document.getElementById('resultsSection');
            const fatigueScoreElement = document.getElementById('fatigueScore');
            const fatigueLevelElement = document.getElementById('fatigueLevel');
            const fatigueScoreCircle = document.getElementById('fatigueScoreCircle');

            // Reset indicators
            document.querySelectorAll('[id$="Indicator"]').forEach(indicator => {
                indicator.className = indicator.className.replace(/bg-fatigue-\w+/, 'bg-gray-200');
                indicator.querySelector('span').className = 'text-xs font-medium text-gray-500';
            });

            let level, color, bgColor;
            if (score <= 3) {
                level = 'Low';
                color = 'bg-fatigue-low';
                bgColor = 'bg-fatigue-low';
                document.getElementById('lowIndicator').className = 'h-8 bg-fatigue-low rounded-t-lg flex items-center justify-center';
                document.getElementById('lowIndicator').querySelector('span').className = 'text-xs font-medium text-white';
            } else if (score <= 6) {
                level = 'Moderate';
                color = 'text-fatigue-moderate';
                bgColor = 'bg-fatigue-moderate';
                document.getElementById('moderateIndicator').className = 'h-8 bg-fatigue-moderate rounded-t-lg flex items-center justify-center';
                document.getElementById('moderateIndicator').querySelector('span').className = 'text-xs font-medium text-white';
            } else if (score <= 8) {
                level = 'High';
                color = 'text-fatigue-high';
                bgColor = 'bg-fatigue-high';
                document.getElementById('highIndicator').className = 'h-8 bg-fatigue-high rounded-t-lg flex items-center justify-center';
                document.getElementById('highIndicator').querySelector('span').className = 'text-xs font-medium text-white';
            } else {
                level = 'Extreme';
                color = 'text-fatigue-extreme';
                bgColor = 'bg-fatigue-extreme';
                document.getElementById('extremeIndicator').className = 'h-8 bg-fatigue-extreme rounded-t-lg flex items-center justify-center';
                document.getElementById('extremeIndicator').querySelector('span').className = 'text-xs font-medium text-white';
            }

            fatigueScoreElement.textContent = score;
            fatigueLevelElement.textContent = level;
            fatigueLevelElement.className = `text-2xl font-bold ${color}`;
            fatigueScoreCircle.className = `inline-flex items-center justify-center w-24 h-24 rounded-full mb-4 ${bgColor}`;

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('fatigueForm').reset();
            document.getElementById('totalSleep48').textContent = '0 hours';
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('fatigueForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Event listeners
        document.getElementById('sleep24').addEventListener('change', updateTotalSleep);
        document.getElementById('sleepPrevious24').addEventListener('change', updateTotalSleep);
        document.getElementById('calculateBtn').addEventListener('click', calculateFatigueScore);
        document.getElementById('recalculateBtn').addEventListener('click', resetForm);

        // Real-time calculation on input change
        document.getElementById('fatigueForm').addEventListener('change', function() {
            const allInputsFilled = document.getElementById('sleep24').value &&
                                   document.getElementById('sleepPrevious24').value &&
                                   document.getElementById('wakeTime').value &&
                                   document.getElementById('workStartTime').value;
            
            if (allInputsFilled) {
                // Auto-calculate after small delay
                setTimeout(calculateFatigueScore, 500);
            }
        });
    })();
    </script>
</body>
</html>